<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Municípios</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f4f4f4; }
        .expandable-content { display: none; }
        .expand-btn { cursor: pointer; background: none; border: none; font-size: 16px; }
        .rotate { transform: rotate(90deg); }
        #map { height: 500px; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>
    <h2>Painel de Municípios</h2>
    <div id="map"></div>
    <table>
        <thead>
            <tr>
                <th>Adesão Municipal</th>
                <th>Município</th>
                <th>Ações</th>
                <th>Plano municipal</th>
                <th>Unidade gestora</th>
                <th>Conselho municipal</th>
                <th>Indicador</th>
            </tr>
        </thead>
        <tbody id="municipios-body"></tbody>
    </table>
    
    <script>
        const municipios = [
            { nome: "São Paulo", lat: -23.5505, lng: -46.6333 },
            { nome: "Rio de Janeiro", lat: -22.9068, lng: -43.1729 },
            { nome: "Belo Horizonte", lat: -19.9167, lng: -43.9345 },
            { nome: "Porto Alegre", lat: -30.0346, lng: -51.2177 },
            { nome: "Salvador", lat: -12.9777, lng: -38.5016 },
            { nome: "Fortaleza", lat: -3.7172, lng: -38.5433 },
        ];

        function getRandomValue(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function generateMunicipiosData() {
            municipios.forEach(m => {
                m.indicador = (Math.random() * 0.9 + 0.1).toFixed(2);
                m.plano = Math.random() > 0.5 ? '✅ Sim' : '❌ Não';
                m.gestora = Math.random() > 0.5 ? '✅ Sim' : '❌ Não';
                m.conselho = Math.random() > 0.5 ? '✅ Sim' : '❌ Não';
            });
            municipios.sort((a, b) => b.indicador - a.indicador);
        }

        function toggleRow(id) {
            let row = document.getElementById(id);
            row.style.display = row.style.display === "none" ? "table-row" : "none";
        }

        function createRow(municipio, index) {
            let color = municipio.indicador >= 0.7 ? 'green' : municipio.indicador >= 0.4 ? 'orange' : 'red';
            return `
                <tr>
                    <td><button class="expand-btn" onclick="toggleRow('adesao-${index}')">▶</button></td>
                    <td>${municipio.nome}</td>
                    <td><button class="expand-btn" onclick="toggleRow('actions-${index}')">▶</button></td>
                    <td>${municipio.plano}</td>
                    <td>${municipio.gestora}</td>
                    <td>${municipio.conselho}</td>
                    <td style="color:${color}; font-weight:bold;">${municipio.indicador}</td>
                </tr>
                <tr id="adesao-${index}" class="expandable-content">
                    <td colspan="7"><strong>Data de adesão:</strong> ${getRandomDate()}<br><strong>Unidade gestora do Plano:</strong> ${getRandomProponent()}</td>
                </tr>
                <tr id="actions-${index}" class="expandable-content">
                    <td colspan="7">
                        <table>
                            <tr>
                                <th>Nome da Iniciativa</th>
                                <th>Descrição da Iniciativa</th>
                                <th>Situação</th>
                            </tr>
                            <tr>
                                <td>Capacitação de gestores</td>
                                <td>Formação de 100 gestores</td>
                                <td>${getRandomStatus()}</td>
                            </tr>
                        </table>
                    </td>
                </tr>`;
        }

        function getRandomDate() {
            return `${('0' + (1 + Math.floor(Math.random() * 28))).slice(-2)}/
                    ${('0' + (1 + Math.floor(Math.random() * 12))).slice(-2)}/
                    ${2020 + Math.floor(Math.random() * 5)}`;
        }

        function getRandomStatus() {
            return getRandomValue(["Não iniciada", "Em execução", "Concluída", "Suspensa"]);
        }

        function getRandomProponent() {
            return getRandomValue(["Secretaria de Educação", "Secretaria de Saúde", "Prefeitura"]);
        }

        function initializeMap() {
            let map = L.map('map').fitBounds(municipios.map(m => [m.lat, m.lng]));
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            municipios.forEach(municipio => {
                L.circleMarker([municipio.lat, municipio.lng], {
                    radius: 8,
                    color: municipio.indicador >= 0.7 ? 'green' : municipio.indicador >= 0.4 ? 'orange' : 'red',
                    fillOpacity: 0.6
                }).bindPopup(`<b>${municipio.nome}</b><br>Indicador: ${municipio.indicador}`).addTo(map);
            });
        }

        generateMunicipiosData();
        document.getElementById('municipios-body').innerHTML = municipios.map(createRow).join('');
        initializeMap();
    </script>
</body>
</html>
